app-id: net.wz2100.wz2100
runtime: org.kde.Platform
runtime-version: '5.13'
sdk: org.kde.Sdk
command: warzone2100
separate-locales: false
finish-args: 
  - --socket=wayland
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --persist=.warzone2100-3.3
  - --socket=pulseaudio
  - --share=network
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.a'
  - '*.la'
  
modules:
  - shared-modules/glu/glu-9.json
  - shared-modules/glew/glew.json
        
  - name: physfs
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
    - -DCMAKE_INSTALL_PREFIX=/app
    - -DCMAKE_BUILD_TYPE=Release
    - -DPHYSFS_BUILD_TEST=OFF
    sources:
      - type: archive
        url: 'http://icculus.org/physfs/downloads/physfs-3.0.2.tar.bz2'
        sha1: 6a15c458898d0570101d8f173201cde9ced78df7
      
  - name: fribidi
    config-opts:
    - --disable-docs
    sources:
      - type: git
        url: https://github.com/fribidi/fribidi
        tag: v1.0.8
        commit: 2e9bd91cfd857c5b78a210d8f24862a4bb704059
      - type: patch
        path: disable-docs.patch
      
  - name: wz2100
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/warzone2100/releases/3.3.0/warzone2100-3.3.0_src.tar.xz
        sha256: cc48c8128d17a499e833996470d843855389d9fc985c71f05be08901f33116e8
      - type: file
        url: https://sourceforge.net/projects/warzone2100/files/warzone2100/Videos/high-quality-en/sequences.wz
        sha256: 90ff552ca4a70e2537e027e22c5098ea4ed1bc11bb7fc94138c6c941a73d29fa        
      - type: file
        path: net.wz2100.wz2100.appdata.xml
    post-install:
      - mkdir -p /app/share/appdata
      - mkdir -p /app/share/icons/hicolor/128x128/apps
      - install -Dm644 sequences.wz /app/share/warzone2100/sequences.wz
      - mv /app/share/applications/warzone2100.desktop /app/share/applications/net.wz2100.wz2100.desktop
      - mv /app/share/icons/warzone2100.png /app/share/icons/hicolor/128x128/apps/net.wz2100.wz2100.png
      - install -Dm644 net.wz2100.wz2100.appdata.xml /app/share/appdata
      - desktop-file-edit --set-key=Icon --set-value='net.wz2100.wz2100' /app/share/applications/net.wz2100.wz2100.desktop

